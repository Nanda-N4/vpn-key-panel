<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title><%= (panelConfig && panelConfig.brandName) ? panelConfig.brandName : "Admin" %></title>

  <link rel="stylesheet" href="/public/00-tokens.css" />
  <link rel="stylesheet" href="/public/01-base.css" />
  <link rel="stylesheet" href="/public/02-layout.css" />
  <link rel="stylesheet" href="/public/03-components.css" />
  <link rel="stylesheet" href="/public/04-pages.css" />
  <link rel="stylesheet" href="/public/05-utilities.css" />
</head>

<body>
  <div class="bg-aurora" aria-hidden="true"></div>

  <div class="app-shell">
    <header class="app-header glass">
      <div class="container header-inner">
        <div class="brand">
          <div class="brand-icon" aria-hidden="true">‚ö°</div>
          <div class="brand-text">
            <div class="brand-title"><%= panelConfig.brandName || "VPN KEY" %></div>
            <div class="brand-sub">Admin Panel</div>
          </div>
        </div>

        <div class="header-actions">
          <a class="pill glass-btn" href="/">üè† Home</a>
          <% if (mode === "dashboard") { %>
            <form method="POST" action="/<%= adminPath %>/logout" style="display:inline;">
              <button class="pill glass-btn" type="submit">Logout</button>
            </form>
          <% } %>
        </div>
      </div>
    </header>

    <main class="container main">
      <% if (mode === "login") { %>
        <section class="card glass">
          <h2 style="margin:0 0 10px 0;">Admin Login</h2>
          <% if (error) { %><div class="toast glass"><strong>‚ö†</strong> <span><%= error %></span></div><% } %>

          <form method="POST" action="/<%= adminPath %>/login" class="form-grid">
            <label class="field">
              <span class="field-label">Password</span>
              <input class="input" type="password" name="password" required />
            </label>
            <button class="btn glass-btn" type="submit">Login</button>
          </form>
        </section>
      <% } %>

      <% if (mode === "dashboard") { %>
        <% if (error) { %>
          <div class="toast glass"><strong>‚ö†</strong> <span><%= error %></span></div>
        <% } %>

        <section class="card glass">
          <h2 style="margin:0 0 12px 0;">Add Key</h2>

          <form method="POST" action="/<%= adminPath %>/add" class="form-grid">
            <input class="input" name="type" value="<%= defaults.type %>" />
            <input class="input" name="region_name" placeholder="Region name" value="<%= defaults.region_name %>" />
            <input class="input" name="region_flag" placeholder="Flag emoji (üá∏üá¨)" value="<%= defaults.region_flag %>" />
            <input class="input" name="gb_limit" type="number" value="<%= defaults.gb_limit %>" />
            <input class="input" name="expire_date" type="date" value="<%= defaults.expire_date %>" />

            <select class="select" name="status">
              <option value="ACTIVE">ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>

            <textarea class="textarea" name="key_string" rows="3" placeholder="Key string (vless://... or ss://... or outline://...)" required></textarea>

            <button class="btn glass-btn" type="submit">Add</button>
          </form>
        </section>

        <section class="card glass">
          <h2 style="margin:0 0 12px 0;">Announcement (Popup)</h2>

          <form method="POST" action="/<%= adminPath %>/announce" class="form-grid">
            <label class="field" style="grid-column: 1 / -1;">
              <span class="field-label">
                <input type="checkbox" name="announce_enabled" value="1" <%= announceEnabled ? "checked" : "" %> />
                Enable popup announcement
              </span>
            </label>

            <textarea class="textarea" name="announce_md" rows="6" placeholder="Markdown allowed"><%= announceMd || "" %></textarea>

            <button class="btn glass-btn" type="submit">Save</button>
          </form>

          <div class="muted" style="margin-top:10px;">
            Note: Markdown ·ÄÄ·Ä≠·ÄØ server.js ·Äô·Äæ·Ä¨ sanitize ·Äú·ÄØ·Äï·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã
          </div>
        </section>

        <section class="card glass">
          <h2 style="margin:0 0 12px 0;">Keys</h2>

          <div class="admin-list">
            <% (keys || []).forEach(k => { %>
              <div class="admin-row glass">
                <div class="admin-row-left">
                  <div class="admin-title"><%= (k.type || '').toUpperCase() %></div>
                  <div class="muted">
                    <%= k.region_flag || "üåç" %> <%= k.region_name %> ‚Ä¢ GB <%= k.gb_limit %> ‚Ä¢ Exp <%= k.expire_date || "-" %>
                  </div>
                  <div class="muted">ID: <%= k.id %> ‚Ä¢ <%= (k.statusComputed || '').toUpperCase() %></div>
                  <a class="link" href="/k/<%= k.id %>" target="_blank" rel="noopener">Open</a>
                </div>

                <div class="admin-row-actions">
                  <form method="POST" action="/<%= adminPath %>/toggle/<%= k.id %>">
                    <button class="btn glass-btn" type="submit">Toggle</button>
                  </form>
                  <form method="POST" action="/<%= adminPath %>/delete/<%= k.id %>" onsubmit="return confirm('Delete?')">
                    <button class="btn danger" type="submit">Delete</button>
                  </form>
                </div>
              </div>
            <% }) %>
          </div>
        </section>
      <% } %>
    </main>
  </div>
</body>
</html>
