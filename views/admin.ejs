<% if (mode === "login") { %>
  <div class="card auth">
    <div class="title">Admin Login</div>
    <% if (error) { %><div class="alert"><%= error %></div><% } %>

    <form method="POST" action="/<%= adminPath %>/login" class="stack-md">
      <input class="input" type="password" name="password" placeholder="Admin password" required />
      <button class="btn btn-pill" type="submit">Login</button>
    </form>

    <div class="spacer"></div>
    <a class="link" href="/">‚Üê Back to user page</a>
  </div>

<% } else { %>

  <div class="stack-lg">
    <div class="row between">
      <div class="title">Admin Dashboard</div>
      <form method="POST" action="/<%= adminPath %>/logout">
        <button class="btn btn-soft" type="submit">Logout</button>
      </form>
    </div>

    <% if (error) { %>
      <div class="card"><div class="alert">Error: <%= error %></div></div>
    <% } %>

    <div class="card">
      <div class="title">Add Key</div>

      <form method="POST" action="/<%= adminPath %>/add" class="grid2">
        <input class="input" name="type" placeholder="Type (V2RAY/OUTLINE)" value="<%= defaults?.type || "V2RAY" %>" required />
        <input class="input" name="region_name" placeholder="Region name" value="<%= defaults?.region_name || "" %>" required />

        <input class="input" name="region_flag" placeholder="Flag emoji (e.g. üá¶üá∫)" value="<%= defaults?.region_flag || "" %>" />
        <input class="input" name="gb_limit" placeholder="GB limit" value="<%= defaults?.gb_limit || 0 %>" />

        <input class="input" name="expire_date" placeholder="Expire date (YYYY-MM-DD)" value="<%= defaults?.expire_date || "" %>" />
        <select class="select" name="status">
          <option value="ACTIVE">ACTIVE</option>
          <option value="INACTIVE">INACTIVE</option>
        </select>

        <textarea class="textarea col2" name="key_string" placeholder="Key string (vless://...)" required></textarea>

        <button class="btn btn-pill col2" type="submit">Add</button>
      </form>
    </div>

    <div class="card">
      <div class="title">Announcement (Popup)</div>

      <form method="POST" action="/<%= adminPath %>/announce" class="stack-md">
        <label class="check">
          <input type="checkbox" name="announce_enabled" value="1" <%= announceEnabled ? "checked" : "" %> />
          Enable popup announcement
        </label>

        <textarea class="textarea" name="announce_md" placeholder="Markdown supported..."><%= announceMd || "" %></textarea>

        <button class="btn btn-pill" type="submit">Save</button>
      </form>

      <div class="muted">Note: Markdown ·ÄÄ·Ä≠·ÄØ server.js ·Äë·Ä≤·Äô·Äæ·Ä¨ sanitize ·Äú·ÄØ·Äï·Ä∫·Äë·Ä¨·Ä∏·Äú·Ä≠·ÄØ·Ä∑ safe ·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Åã</div>
    </div>

    <div class="card">
      <div class="title">Keys</div>

      <% if (!keys || keys.length === 0) { %>
        <div class="muted">No keys yet.</div>
      <% } %>

      <div class="table">
        <% (keys || []).forEach(function(k){ %>
          <div class="trow">
            <div class="tmain">
              <div class="key-type"><%= k.type %></div>
              <div class="muted"><%= k.region_flag || "üåê" %> <%= k.region_name %> ‚Ä¢ GB <%= k.gb_limit || 0 %> ‚Ä¢ Exp <%= k.expire_date || "-" %></div>
              <div class="muted">ID: <%= k.id %> ‚Ä¢ <%= k.statusComputed %></div>
            </div>

            <div class="tactions">
              <a class="btn btn-soft" href="<%= k.link %>" target="_blank" rel="noopener">Open</a>

              <form method="POST" action="/<%= adminPath %>/toggle/<%= k.id %>">
                <button class="btn btn-soft" type="submit">Toggle</button>
              </form>

              <form method="POST" action="/<%= adminPath %>/delete/<%= k.id %>" onsubmit="return confirm('Delete this key?');">
                <button class="btn btn-danger" type="submit">Delete</button>
              </form>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </div>

<% } %>
