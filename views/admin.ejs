<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title><%= panelConfig.brandName || "VPN KEY" %> - Admin</title>

  <link rel="stylesheet" href="/public/00-tokens.css" />
  <link rel="stylesheet" href="/public/01-base.css" />
  <link rel="stylesheet" href="/public/02-layout.css" />
  <link rel="stylesheet" href="/public/03-components.css" />
  <link rel="stylesheet" href="/public/04-pages.css" />
  <link rel="stylesheet" href="/public/05-utilities.css" />
</head>
<body>
  <div class="bg-aurora" aria-hidden="true"></div>

  <div class="app-shell">
    <header class="app-header">
      <div class="container header-inner">
        <div class="brand">
          <span class="brand-icon" aria-hidden="true">‚ö°</span>
          <div class="brand-text">
            <div class="brand-title"><%= panelConfig.brandName || "VPN KEY" %></div>
            <div class="brand-sub">Admin Panel</div>
          </div>
        </div>

        <div class="header-actions">
          <a class="btn btn-ghost" href="/" target="_self">üè† Home</a>
          <% if (mode === "dashboard") { %>
            <form method="POST" action="/<%= adminPath %>/logout">
              <button class="btn btn-soft" type="submit">Logout</button>
            </form>
          <% } %>
        </div>
      </div>
    </header>

    <main class="container main">
      <% if (mode === "login") { %>
        <section class="card admin">
          <h2 class="section-title">Admin Login</h2>
          <% if (error) { %><div class="card error"><%= error %></div><% } %>

          <form method="POST" action="/<%= adminPath %>/login" class="form">
            <label class="label">Password</label>
            <input class="input" type="password" name="password" placeholder="Enter admin password" required />
            <button class="btn" type="submit">Login</button>
          </form>
        </section>
      <% } else { %>

        <% if (error) { %>
          <div class="card error">Error: <%= error %></div>
        <% } %>

        <section class="card admin">
          <h2 class="section-title">Add Key</h2>

          <form method="POST" action="/<%= adminPath %>/add" class="grid">
            <input class="input" name="type" value="<%= (defaults && defaults.type) ? defaults.type : "V2RAY" %>" placeholder="V2RAY / OUTLINE" required />
            <input class="input" name="region_name" value="<%= (defaults && defaults.region_name) ? defaults.region_name : "" %>" placeholder="Region name" required />
            <input class="input" name="region_flag" value="<%= (defaults && defaults.region_flag) ? defaults.region_flag : "" %>" placeholder="Flag emoji (üá∏üá¨)" />
            <input class="input" name="gb_limit" type="number" value="<%= (defaults && defaults.gb_limit!=null) ? defaults.gb_limit : 0 %>" placeholder="GB limit" />
            <input class="input" name="expire_date" value="<%= (defaults && defaults.expire_date) ? defaults.expire_date : "" %>" placeholder="YYYY-MM-DD" />
            <select class="select" name="status">
              <option value="ACTIVE" selected>ACTIVE</option>
              <option value="INACTIVE">INACTIVE</option>
            </select>

            <textarea class="textarea" name="key_string" placeholder="Key string (vless://... or ss://... or outline://...)" required></textarea>

            <button class="btn" type="submit">Add</button>
          </form>
        </section>

        <section class="card admin">
          <h2 class="section-title">Announcement (Popup)</h2>
          <p class="muted">
            Note: Markdown ·ÄÄ·Ä≠·ÄØ server.js ·Äô·Äæ·Ä¨ sanitize ·Äú·ÄØ·Äï·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äê·Äö·Ä∫·Åã
          </p>

          <form method="POST" action="/<%= adminPath %>/announce" class="form">
            <label class="checkbox">
              <input type="checkbox" name="announce_enabled" value="1" <%= announceEnabled ? "checked" : "" %> />
              Enable popup announcement
            </label>

            <textarea class="textarea" name="announce_md" placeholder="# üî• New Update&#10;‚úÖ Australia key..."><%= announceMd || "" %></textarea>

            <button class="btn" type="submit">Save Announcement</button>
          </form>
        </section>

        <section class="card admin">
          <h2 class="section-title">Keys</h2>

          <% (keys || []).forEach(function(k){ %>
            <div class="key-admin">
              <div class="key-admin-row">
                <div class="key-admin-main">
                  <div class="key-admin-type"><%= k.type %></div>
                  <div class="key-admin-region"><%= k.region_flag || "üåê" %> <%= k.region_name %> ‚Ä¢ GB <%= k.gb_limit || 0 %> ‚Ä¢ Exp <%= k.expire_date || "-" %></div>
                  <div class="key-admin-meta">ID: <%= k.id %> ‚Ä¢ <b><%= (k.statusComputed || '').toUpperCase() %></b></div>
                  <a href="<%= k.link %>" target="_blank" rel="noopener">Open</a>
                </div>

                <div class="key-admin-actions">
                  <form method="POST" action="/<%= adminPath %>/toggle/<%= k.id %>">
                    <button class="btn btn-soft" type="submit">Toggle</button>
                  </form>
                  <form method="POST" action="/<%= adminPath %>/delete/<%= k.id %>" onsubmit="return confirm('Delete this key?');">
                    <button class="btn btn-ghost" type="submit">Delete</button>
                  </form>
                </div>
              </div>
            </div>
          <% }) %>
        </section>

      <% } %>

      <p class="copyright">¬© <%= new Date().getFullYear() %> <%= panelConfig.brandName || "VPN KEY" %></p>
    </main>
  </div>
</body>
</html>
