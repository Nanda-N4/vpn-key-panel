<% if (error) { %>
  <div class="card">
    <div class="title">Error</div>
    <div class="muted"><%= error %></div>
    <div class="spacer"></div>
    <a class="btn btn-pill" href="/">â† Back</a>
  </div>
<% } else if (!item) { %>
  <div class="card">
    <div class="muted">Key á€™á€á€½á€±á€·á€•á€«á‹</div>
    <div class="spacer"></div>
    <a class="btn btn-pill" href="/">â† Back</a>
  </div>
<% } else { %>

<div class="stack-lg">
  <section class="card">
    <div class="row between">
      <a class="btn btn-soft" href="/">â† Back</a>
      <span class="badge <%= (item.statusComputed || 'ACTIVE').toLowerCase() %>">
        <%= item.statusComputed || "ACTIVE" %>
      </span>
    </div>

    <div class="stack-sm">
      <div class="key-type big"><%= item.type %></div>

      <div class="key-meta">
        <span class="flag"><%= item.region_flag || "ğŸŒ" %></span>
        <span class="region"><%= item.region_name %></span>
      </div>

      <div class="key-sub">
        <span>GB <%= item.gb_limit || 0 %></span>
        <span class="dot">â€¢</span>
        <span>Expire <%= item.expire_date || "-" %></span>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="field">
      <div class="label">Key</div>
      <div class="copybox">
        <div class="copytext" id="keyText"><%= item.key_string %></div>
        <button class="btn btn-pill" type="button" id="copyBtn">ğŸ“‹ Copy</button>
      </div>
      <div class="muted">Copy á€•á€¼á€®á€¸á€›á€„á€º á€á€„á€ºá€· App á€‘á€² Paste â†’ Connect á€œá€¯á€•á€ºá€•á€«</div>
    </div>
  </section>

  <section class="card">
    <div class="title">Download Apps</div>

    <div class="apps">
      <% (apps || []).forEach(function(a){ %>
        <a class="app" href="<%= a.url %>" target="_blank" rel="noopener">
          <div class="app-left">
            <div class="app-name"><%= a.name %></div>
            <div class="muted"><%= a.sub %></div>
          </div>
          <div class="app-right">â†—</div>
        </a>
      <% }) %>
    </div>

    <div class="spacer"></div>

    <div class="row">
      <% if (panelConfig?.telegramAdminUrl && panelConfig.telegramAdminUrl !== "#") { %>
        <a class="btn btn-soft" href="<%= panelConfig.telegramAdminUrl %>" target="_blank" rel="noopener">ğŸ’¬ Contact Admin</a>
      <% } %>
      <% if (panelConfig?.telegramChannelUrl && panelConfig.telegramChannelUrl !== "#") { %>
        <a class="btn btn-soft" href="<%= panelConfig.telegramChannelUrl %>" target="_blank" rel="noopener">ğŸ“£ Join Channel</a>
      <% } %>
    </div>
  </section>
</div>

<script>
  (function () {
    var btn = document.getElementById("copyBtn");
    var t = document.getElementById("keyText");
    if (!btn || !t) return;

    btn.addEventListener("click", async function () {
      var ok = await window.copyText(t.textContent || "");
      btn.textContent = ok ? "âœ… Copied" : "âŒ Failed";
      setTimeout(function () { btn.textContent = "ğŸ“‹ Copy"; }, 1200);
    });
  })();
</script>

<% } %>
