<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title><%= (panelConfig && panelConfig.brandName) ? panelConfig.brandName : "VPN KEY" %> - Detail</title>

  <link rel="stylesheet" href="/public/00-tokens.css" />
  <link rel="stylesheet" href="/public/01-base.css" />
  <link rel="stylesheet" href="/public/02-layout.css" />
  <link rel="stylesheet" href="/public/03-components.css" />
  <link rel="stylesheet" href="/public/04-pages.css" />
  <link rel="stylesheet" href="/public/05-utilities.css" />
</head>
<body>
  <div class="bg-aurora" aria-hidden="true"></div>

  <div class="app-shell">
    <header class="app-header">
      <div class="container header-inner">
        <div class="brand">
          <span class="brand-icon" aria-hidden="true">⚡</span>
          <div class="brand-text">
            <div class="brand-title"><%= panelConfig.brandName || "VPN KEY" %></div>
            <div class="brand-sub">Fast • Simple • Secure</div>
          </div>
        </div>

        <div class="header-actions">
          <% if (panelConfig && panelConfig.telegramChannelUrl) { %>
            <a class="btn btn-ghost" href="<%= panelConfig.telegramChannelUrl %>" target="_blank" rel="noopener">
              ✈️ <span><%= panelConfig.telegramChannelText || "Channel" %></span>
            </a>
          <% } %>
        </div>
      </div>
    </header>

    <main class="container main">
      <a class="btn btn-ghost back" href="/">← Back</a>

      <% if (error) { %>
        <div class="card error"><%= error %></div>
      <% } %>

      <% if (!item) { %>
        <div class="card empty">
          <div class="empty-title">Key မတွေ့ပါ။</div>
          <div class="empty-sub">Back ပြန်သွားပြီး ပြန်ရွေးပါ။</div>
        </div>
      <% } else { %>
        <section class="card detail">
          <div class="detail-top">
            <span class="pill <%= (item.statusComputed || '').toUpperCase() %>">
              <%= (item.statusComputed || '').toUpperCase() %>
            </span>
            <div class="detail-type"><%= item.type %></div>
          </div>

          <div class="detail-region">
            <span class="flag"><%= item.region_flag || "🌐" %></span>
            <div>
              <div class="region"><%= item.region_name %></div>
              <div class="meta">
                GB <b><%= item.gb_limit || 0 %></b>
                <span class="dot">•</span>
                Expire <b><%= item.expire_date || "-" %></b>
              </div>
            </div>
          </div>

          <div class="detail-key-label">Key</div>
          <div class="keybox">
            <input id="keyString" class="input key-input" value="<%= item.key_string %>" readonly />
            <button class="btn" id="btnCopy" type="button">📋 Copy</button>
          </div>

          <div class="hint">Copy ပြီးရင် သင့်သုံးမယ့် App ထဲ Paste → Connect လုပ်ပါ</div>

          <div class="apps">
            <div class="apps-title">Download Apps</div>
            <div class="apps-grid">
              <% (apps || []).forEach(function(a){ %>
                <a class="app-link" href="<%= a.url %>" target="_blank" rel="noopener">
                  <div class="app-name"><%= a.name %></div>
                  <div class="app-sub"><%= a.sub %></div>
                  <div class="app-arrow">↗</div>
                </a>
              <% }) %>
            </div>
          </div>

          <div class="footer-actions">
            <a class="btn btn-soft" href="<%= panelConfig.telegramAdminUrl || '#' %>" target="_blank" rel="noopener">💬 Contact Admin</a>
            <a class="btn btn-ghost" href="<%= panelConfig.telegramChannelUrl || '#' %>" target="_blank" rel="noopener">📣 Join Channel</a>
          </div>
        </section>
      <% } %>

      <p class="copyright">© <%= new Date().getFullYear() %> <%= panelConfig.brandName || "VPN KEY" %></p>
    </main>
  </div>

  <script>
    (function(){
      const btn = document.getElementById("btnCopy");
      const input = document.getElementById("keyString");
      if (!btn || !input) return;

      btn.addEventListener("click", async function(){
        try{
          input.focus();
          input.select();
          input.setSelectionRange(0, 999999);
          await navigator.clipboard.writeText(input.value);
          btn.textContent = "✅ Copied";
          setTimeout(()=>btn.textContent="📋 Copy", 1200);
        }catch(e){
          document.execCommand("copy");
          btn.textContent = "✅ Copied";
          setTimeout(()=>btn.textContent="📋 Copy", 1200);
        }
      });
    })();
  </script>
</body>
</html>
