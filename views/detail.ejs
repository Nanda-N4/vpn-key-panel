<%- include("layout", {
  title: item ? (item.type + " â€¢ " + item.region_name) : "Key",
  panelConfig,
  body: `
  <section class="section">
    ${
      error ? `
        <div class="glass empty">
          <div class="emptyTitle">${error}</div>
          <a class="btn" href="/"><span class="btnIcon">â†</span> Back</a>
        </div>
      ` : `
        <div class="glass detailCard">
          <div class="detailTop">
            <a class="btn small ghost" href="/"><span class="btnIcon">â†</span> Back</a>
            <div class="badge ${item.statusComputed === "ACTIVE" ? "ok" : (item.statusComputed === "EXPIRED" ? "bad" : "muted")}">
              ${item.statusComputed}
            </div>
          </div>

          <div class="detailTitle">
            <div class="detailType">${item.type}</div>
            <div class="detailRegion"><span class="flag">${item.region_flag || "ğŸŒ"}</span> ${item.region_name}</div>
          </div>

          <div class="detailMeta">
            <span>${item.gb_limit ? `GB ${item.gb_limit}` : "No limit"}</span>
            <span class="dot">â€¢</span>
            <span>${item.expire_date ? `Expire ${item.expire_date}` : "No expiry"}</span>
          </div>

          <div class="keyBox">
            <div class="keyLabel">Key</div>
            <div class="keyRow">
              <input id="keyText" class="input mono" value="${item.key_string.replace(/"/g, "&quot;")}" readonly />
              <button class="btn primary" id="copyBtn" type="button">
                <span class="btnIcon">ğŸ“‹</span> Copy
              </button>
            </div>
            <div class="keyNote">Copy á€•á€¼á€®á€¸á€›á€„á€º á€á€„á€ºá€á€¯á€¶á€¸á€™á€šá€·á€º App á€‘á€² Paste â†’ Connect á€œá€¯á€•á€ºá€•á€«</div>
          </div>
        </div>

        <div class="glass appsCard">
          <div class="appsTitle">Download Apps</div>
          <div class="appsGrid">
            ${apps.map(a => `
              <a class="appTile" href="${a.url}" target="_blank" rel="noopener">
                <div class="appIcon ${a.icon}"></div>
                <div class="appText">
                  <div class="appName">${a.name}</div>
                  <div class="appSub">${a.sub}</div>
                </div>
                <div class="appGo">â†—</div>
              </a>
            `).join("")}
          </div>
        </div>

        <div class="glass helpCard compact">
          <div class="helpTitle">Need help / Buy key?</div>
          <div class="helpActions">
            <a class="btn" href="${panelConfig.telegramAdminUrl || "#"}" target="_blank" rel="noopener">
              <span class="btnIcon">ğŸ’¬</span> Contact Admin
            </a>
            <a class="btn ghost" href="${panelConfig.telegramChannelUrl || "#"}" target="_blank" rel="noopener">
              <span class="btnIcon">ğŸ“¢</span> Join Channel
            </a>
          </div>
        </div>

        <script>
          const btn = document.getElementById("copyBtn");
          const input = document.getElementById("keyText");

          btn?.addEventListener("click", async () => {
            try {
              input.select();
              input.setSelectionRange(0, 999999);
              await navigator.clipboard.writeText(input.value);
              window.__toast && window.__toast("Copied âœ…");
            } catch (e) {
              // fallback
              document.execCommand("copy");
              window.__toast && window.__toast("Copied âœ…");
            }
          });
        </script>
      `
    }
  </section>
  `
}) %>
