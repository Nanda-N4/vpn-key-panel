<%- include("layout", {
  title: item ? (item.type + " â€¢ " + item.region_name) : "Key",
  panelConfig,
  content: `
    <section class="card section">
      ${
        error
          ? `
            <div class="alert alert-danger">${error}</div>
            <a class="btn btn-ghost btn-pill" href="/">â† Back</a>
          `
          : `
            <div class="detail-head">
              <a class="btn btn-ghost btn-pill" href="/">â† Back</a>
              <div class="pill ${String(item.statusComputed).toLowerCase()==="active" ? "pill-active" : "pill-muted"}">
                ${item.statusComputed}
              </div>
            </div>

            <div class="detail-title">${item.type}</div>
            <div class="detail-region">
              <span class="flag">${item.region_flag || ""}</span>
              <span>${item.region_name}</span>
            </div>
            <div class="muted">
              ${item.gb_limit ? `GB ${item.gb_limit}` : "No limit"} â€¢
              ${item.expire_date ? `Expire ${item.expire_date}` : "No expiry"}
            </div>

            <div class="card-soft keybox">
              <div class="keybox-label">Key</div>
              <div class="keybox-row">
                <input class="input key-input" id="keyInput" readonly value="${item.key_string || ""}" />
                <button class="btn btn-primary btn-pill" type="button" id="copyBtn">ğŸ“‹ Copy</button>
              </div>
              <div class="muted">Copy á€•á€¼á€®á€¸á€›á€„á€º á€á€„á€ºá€á€¯á€¶á€¸á€™á€šá€·á€º App á€‘á€² Paste â†’ Connect á€œá€¯á€•á€ºá€•á€«</div>
            </div>

            <div class="card-soft">
              <div class="section-title">Download Apps</div>
              <div class="apps">
                ${apps.map(a => `
                  <a class="app-link" href="${a.url}" target="_blank" rel="noopener">
                    <div class="app-name">${a.name}</div>
                    <div class="muted">${a.sub}</div>
                    <div class="app-arrow">â†—</div>
                  </a>
                `).join("")}
              </div>
            </div>

            <div class="card-soft">
              <div class="section-title">Need help / Buy key?</div>
              <div class="bottom-actions">
                <a class="btn btn-ghost btn-pill" href="${panelConfig.telegramAdminUrl || "#"}">ğŸ’¬ Contact Admin</a>
                <a class="btn btn-ghost btn-pill" href="${panelConfig.channelUrl || "#"}" target="_blank" rel="noopener">ğŸ“¢ Join Channel</a>
              </div>
            </div>

            <script>
              (function () {
                const input = document.getElementById("keyInput");
                const btn = document.getElementById("copyBtn");
                if (!input || !btn) return;

                async function doCopy() {
                  try {
                    input.select();
                    input.setSelectionRange(0, 99999);
                    if (navigator.clipboard && window.isSecureContext) {
                      await navigator.clipboard.writeText(input.value);
                    } else {
                      document.execCommand("copy");
                    }
                    btn.textContent = "âœ… Copied";
                    setTimeout(() => (btn.textContent = "ğŸ“‹ Copy"), 1200);
                  } catch (e) {
                    btn.textContent = "âŒ Failed";
                    setTimeout(() => (btn.textContent = "ğŸ“‹ Copy"), 1200);
                  }
                }

                btn.addEventListener("click", doCopy);
              })();
            </script>
          `
      }
    </section>
  `
}) %>
