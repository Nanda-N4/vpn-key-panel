<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title><%= panelConfig?.brandName || "VPN KEY" %></title>

  <link rel="stylesheet" href="/public/00-tokens.css" />
  <link rel="stylesheet" href="/public/01-base.css" />
  <link rel="stylesheet" href="/public/02-layout.css" />
  <link rel="stylesheet" href="/public/03-components.css" />
  <link rel="stylesheet" href="/public/04-pages.css" />
  <link rel="stylesheet" href="/public/05-utilities.css" />
</head>

<body>
<div class="bg-aurora" aria-hidden="true"></div>

<div class="app-shell">

  <!-- HEADER (Same as N4 style) -->
  <header class="app-header glass">
    <div class="container header-inner">

      <div class="brand">
        <img src="/public/images/n4logo.png" alt="N4 Logo" class="logo-img">
        <div class="brand-title">N4 VPN</div>
      </div>

      <% if (panelConfig?.telegramChannelUrl) { %>
        <a class="pill glass-btn small"
           href="<%= panelConfig.telegramChannelUrl %>"
           target="_blank"
           rel="noopener">
           üì¢ Join Channel
        </a>
      <% } %>

    </div>
  </header>

  <main class="container main">

    <div class="top-row">
      <a class="pill glass-btn" href="/">‚Üê Back</a>
    </div>

    <% if (error) { %>
      <section class="card glass" style="padding:16px;">
        <h2 style="margin:0 0 8px 0;">Error</h2>
        <p style="margin:0;"><%= error %></p>
      </section>
    <% } %>

    <% if (item) { %>
      <section class="card glass detail-card">

        <div class="detail-head">
          <div class="status-pill <%= (item.statusComputed || '').toLowerCase() %>">
            <%= (item.statusComputed || '').toUpperCase() %>
          </div>

          <h2 class="detail-title"><%= (item.type || '').toUpperCase() %></h2>

          <div class="detail-region">
            <span class="flag"><%= item.region_flag || "üåç" %></span>
            <span><%= item.region_name || "Unknown" %></span>
          </div>

          <div class="key-meta">
            <span class="dot">GB <%= item.gb_limit || 0 %></span>
            <span class="dot">Expire <%= item.expire_date || "-" %></span>
          </div>
        </div>

        <!-- KEY -->
        <div class="key-box">
          <div class="key-label">Key</div>
          <div class="key-row">
            <input id="keyInput" class="input key-input" readonly value="<%= item.key_string || '' %>" />
            <button class="btn glass-btn" type="button" onclick="copyKey()">üìã Copy</button>
          </div>
          <div class="muted">Copy ‚Üí App ·Äë·Ä≤ Paste ‚Üí Connect</div>
        </div>

        <!-- DOWNLOAD APPS -->
        <div class="apps">
          <div class="apps-title">Download Apps</div>

          <div class="apps-grid apps-grid-cards">
            <% (apps || []).forEach(a => { %>
              <a class="app-item glass app-platform <%= a.icon %>"
                 href="<%= a.url %>" target="_blank" rel="noopener">

                <div class="app-left">

                  <% if (a.icon === "windows") { %>
                    <svg viewBox="0 0 24 24" class="app-icon" aria-hidden="true">
                      <path fill="currentColor"
                        d="M3 4l8-1v9H3V4zm0 16l8 1v-9H3v8zm10-17l8-1v10h-8V3zm0 18l8 1v-9h-8v8z"/>
                    </svg>
                  <% } else if (a.icon === "apple") { %>
                    <svg viewBox="0 0 24 24" class="app-icon" aria-hidden="true">
                      <path fill="currentColor"
                        d="M16.365 1.43c0 1.14-.48 2.21-1.25 2.97-.78.77-1.84 1.25-3 1.25-.08-1.14.45-2.32 1.23-3.09C14.1 1.8 15.19 1.37 16.36 1.43zM20.9 17.6c-.4.9-.9 1.7-1.5 2.4-.9 1-1.8 2-3.3 2-1.4 0-1.8-.9-3.4-.9s-2 .9-3.4.9c-1.5 0-2.5-1-3.4-2-1.7-1.9-3-5.2-3-8.1 0-2.8 1.8-4.3 3.5-4.3 1.4 0 2.6 1 3.4 1s2.3-1.2 3.9-1c.7 0 2.7.3 4 2.1-3.5 1.9-2.9 6.9 1.2 8z"/>
                    </svg>
                  <% } else if (a.icon === "android") { %>
                    <svg viewBox="0 0 24 24" class="app-icon" aria-hidden="true">
                      <path fill="currentColor"
                        d="M7 9h10v8H7zM9 4l1-2h4l1 2M8 9V7h8v2M6 9h2v8H6M16 9h2v8h-2"/>
                    </svg>
                  <% } %>

                  <div>
                    <div class="app-name"><%= a.name %></div>
                    <div class="app-sub"><%= a.sub %></div>
                  </div>

                </div>

                <div class="app-arrow" aria-hidden="true">
                  <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor"
                      d="M14 3h7v7h-2V6.4l-9.3 9.3-1.4-1.4L17.6 5H14V3z"/>
                  </svg>
                </div>

              </a>
            <% }) %>
          </div>
        </div>

        <!-- ACTIONS (Spacing fixed) -->
        <div class="detail-actions detail-actions-split">
          <% if (panelConfig?.telegramAdminUrl) { %>
            <a class="pill glass-btn action-pill"
               href="<%= panelConfig.telegramAdminUrl %>"
               target="_blank" rel="noopener">
              üí¨ Contact Admin
            </a>
          <% } %>

          <% if (panelConfig?.telegramChannelUrl) { %>
            <a class="pill glass-btn action-pill"
               href="<%= panelConfig.telegramChannelUrl %>"
               target="_blank" rel="noopener">
              üì¢ Join Channel
            </a>
          <% } %>
        </div>

      </section>

      <footer class="footer">
        ¬© <%= new Date().getFullYear() %> <%= panelConfig?.brandName || "N4 VPN" %>
      </footer>

    <% } %>

  </main>
</div>

<script>
function copyKey(){
  const el = document.getElementById("keyInput");
  if(!el) return;
  el.focus();
  el.select();
  el.setSelectionRange(0, 999999);
  try { document.execCommand("copy"); } catch(e) {}
}
</script>

</body>
</html>
