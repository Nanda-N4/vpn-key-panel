<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title><%= panelConfig?.brandName || "VPN KEY" %></title>

  <link rel="stylesheet" href="/public/00-tokens.css" />
  <link rel="stylesheet" href="/public/01-base.css" />
  <link rel="stylesheet" href="/public/02-layout.css" />
  <link rel="stylesheet" href="/public/03-components.css" />
  <link rel="stylesheet" href="/public/04-pages.css" />
  <link rel="stylesheet" href="/public/05-utilities.css" />
</head>

<body>
<div class="bg-aurora"></div>

<div class="app-shell">

  <!-- HEADER -->
  <header class="app-header glass">
    <div class="container header-inner">

      <div class="brand">
        <img src="/public/images/n4logo.png" alt="N4 Logo" class="logo-img">
        <div class="brand-title">N4 VPN</div>
      </div>

      <% if (panelConfig?.telegramChannelUrl) { %>
        <a class="pill glass-btn small"
           href="<%= panelConfig.telegramChannelUrl %>"
           target="_blank"
           rel="noopener">
          <%= panelConfig.telegramChannelText || "Join Channel" %>
        </a>
      <% } %>

    </div>
  </header>
<% if (panelConfig?.announceHtml) { %>
  <div id="announceModal" class="modal-overlay" hidden>
    <div class="modal glass" role="dialog" aria-modal="true" aria-labelledby="announceTitle">
      <div class="modal-head">
        <div id="announceTitle" class="modal-title">Announcement</div>
        <button class="modal-close glass-btn" type="button" onclick="closeAnnounce()">‚úï</button>
      </div>

      <div class="modal-body">
        <%- panelConfig.announceHtml %>
      </div>

      <div class="modal-actions">
        <button class="pill glass-btn" type="button" onclick="closeAnnounce()">OK</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const v = "<%= panelConfig.announceVersion || '' %>";
      if(!v) return;

      const key = "announce_dismissed_" + v;
      const dismissed = localStorage.getItem(key) === "1";
      if(dismissed) return;

      const el = document.getElementById("announceModal");
      if(!el) return;
      el.hidden = false;

      window.closeAnnounce = function(){
        localStorage.setItem(key, "1");
        el.hidden = true;
      };
    })();
  </script>
<% } %>

  <main class="container main">

    <!-- HERO -->
    <section class="card hero glass">

      <h1 class="hero-title">
        <%= panelConfig?.brandName || "Free Key" %>
      </h1>

      <div class="hero-sub">
        Fast ‚Ä¢ Secure ‚Ä¢ Simple
      </div>

      <!-- Tabs -->
      <div class="tabs-header">
        <button class="tab-btn active" onclick="switchTab('list', event)">
          Key List
        </button>
        <button class="tab-btn" onclick="switchTab('guide', event)">
          Key ·Äõ·Äö·Ä∞·Äî·Ää·Ä∫·Ä∏
        </button>
      </div>

    </section>


    <!-- TAB: KEY LIST -->
    <div id="tab-list" class="tab-content active">

      <section class="card glass filters">
        <details <%= (query.q || query.type || query.status) ? "open" : "" %>>
          <summary class="glass-btn filter-summary">
            Filter
            <span>
              <%= (query.q || query.type || query.status) ? "Active" : "Tap to expand" %>
            </span>
          </summary>

          <form method="GET" action="/" class="filters-grid compact">

            <input type="text"
                   class="input"
                   name="q"
                   placeholder="Search location..."
                   value="<%= query.q || '' %>" />

            <select class="select" name="type">
              <option value="">All Types</option>
              <% (types || []).forEach(t => { %>
                <option value="<%= t %>" <%= query.type === t ? "selected" : "" %>>
                  <%= t %>
                </option>
              <% }) %>
            </select>

            <select class="select" name="status">
              <option value="">All Status</option>
              <% (statuses || []).forEach(s => { %>
                <option value="<%= s %>" <%= query.status === s ? "selected" : "" %>>
                  <%= s %>
                </option>
              <% }) %>
            </select>

            <div class="filter-actions">
              <button class="btn glass-btn" type="submit">Apply</button>
              <a class="btn glass-btn" href="/">Reset</a>
            </div>

          </form>
        </details>
      </section>


      <!-- KEYS -->
      <section class="keys-grid">

        <% if (!items || items.length === 0) { %>
          <div class="card glass empty">
            No keys found.
          </div>
        <% } %>

        <% (items || []).forEach(item => { %>

          <article class="key-card glass">

            <div class="key-card-top">
              <div class="key-type">
                <%= (item.type || "").toUpperCase() %>
              </div>

              <div class="status-pill <%= (item.statusComputed || '').toLowerCase() %>">
                <%= (item.statusComputed || "").toUpperCase() %>
              </div>
            </div>

            <div class="key-region">
              <span class="flag"><%= item.region_flag || "üåç" %></span>
              <span class="region"><%= item.region_name || "Unknown" %></span>
            </div>

            <div class="key-meta">
              <span class="dot">
                <%= (panelConfig?.uiText?.labels?.gbShort || "GB") %> <%= item.gb_limit || 0 %>
              </span>
              <span class="dot">
                <%= (panelConfig?.uiText?.labels?.expireShort || "Expire") %> <%= item.expire_date || "-" %>
              </span>
            </div>

            <a href="/k/<%= item.id %>" class="key-open">
              Tap to open ‚Üí
            </a>

          </article>

        <% }) %>

      </section>
    </div>


    <!-- TAB: GUIDE -->
    <div id="tab-guide" class="tab-content">
      <div class="card glass" style="padding:20px;">

        <ol style="margin-bottom:20px;">
          <li>·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äú·Ä≠·ÄØ·Äû·Ää·Ä∑·Ä∫ Key ·ÄÄ·Ä≠·ÄØ ·Äõ·ÄΩ·Ä±·Ä∏·Äï·Äº·ÄÆ·Ä∏ Copy ·Äö·Ä∞·Äï·Ä´</li>
          <li>·Äô·Ä≠·Äô·Ä≠·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äô·Ää·Ä∑·Ä∫ App ·Äë·Ä≤ Import ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äï·Ä´</li>
          <li>·Äô·Äñ·Äº·ÄÖ·Ä∫·Äï·Ä´·ÄÄ Admin ·ÄÄ·Ä≠·ÄØ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫</li>
        </ol>

        <!-- GUIDE ACTION BUTTONS -->
        <div class="guide-actions">

          <% if (panelConfig?.telegramAdminUrl) { %>
            <a class="pill glass-btn"
               href="<%= panelConfig.telegramAdminUrl %>"
               target="_blank"
               rel="noopener">
              <%= panelConfig.telegramAdminText || "Contact Admin" %>
            </a>
          <% } %>

          <% if (panelConfig?.telegramChannelUrl) { %>
            <a class="pill glass-btn"
               href="<%= panelConfig.telegramChannelUrl %>"
               target="_blank"
               rel="noopener">
              <%= panelConfig.telegramChannelText || "Join Channel" %>
            </a>
          <% } %>

        </div>

      </div>
    </div>


    <footer class="footer">
      ¬© <%= new Date().getFullYear() %> N4 VPN
    </footer>

  </main>
</div>


<script>
function switchTab(name, event){
  document.querySelectorAll('.tab-btn').forEach(btn=>btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));

  event.target.classList.add('active');
  document.getElementById('tab-'+name).classList.add('active');
}
</script>

</body>
</html>
